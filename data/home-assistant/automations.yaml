- id: goodnight
  alias: Goodnight
  trigger:
    platform: event
    event_type: call_service
    event_data:
      service_data:
        entity_id: scene.goodnight_house
      domain: scene
      service: turn_on
  action:
    - service: rest_command.alarm_stay
    - service: climate.set_temperature
      data:
        entity_id: group.climate_control
        temperature: 74

- id: wakeup
  alias: Wakeup
  trigger:
    platform: time
    at: '06:20:00'
  action:
    - service: rest_command.alarm_disarm
    - service: lock.unlock
      entity_id: lock.garage_door_locked
    - service: climate.set_temperature
      data_template:
        entity_id: group.climate_control
        temperature: >-
          {%- if states('sensor.pws_temp_high_1d_c') | int < 74 -%}
            70
          {%- else -%}
            77
          {%- endif -%}
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
    - service: switch.turn_on
      entity_id:
        - switch.kitchen_cabinet_lights_switch
        - switch.mudroom_hallway_lights_switch

- id: evening
  alias: Evening
  trigger:
    platform: time
    at: '16:45:00'
  action:
    - service: switch.turn_on
      entity_id: switch.kitchen_cabinet_lights_switch
    - service: climate.set_temperature
      data:
        entity_id: climate.playroom
        temperature: 74

- id: sunrise
  alias: Sunrise
  trigger:
    platform: sun
    event: sunrise
  action:
    service: switch.turn_off
    entity_id: group.outdoor_lights

- id: before_sunset
  alias: Before sunset
  trigger:
    platform: sun
    event: sunset
    offset: '-00:40:00'
  action:
    - service: switch.turn_on
      entity_id:
        - group.outdoor_lights
        - switch.step_lights_switch
    - service: light.turn_on
      entity_id:
        - light.master_bedroom_lamp_level

- id: wakeup_teardown
  alias: Wakeup teardown
  trigger:
    platform: time
    at: '08:20:00'
  condition:
    condition: time
    weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
    service: switch.turn_off
    entity_id:
      - switch.kitchen_cabinet_lights_switch
      - switch.mudroom_hallway_lights_switch
      - switch.step_lights_switch

- id: left_garage_door_timeout
  alias: Left garage door timeout
  trigger:
    platform: state
    entity_id: cover.left_door
  action:
    - delay:
        minutes: 10
    - service: cover.close_cover
      entity_id: cover.left_door

- id: right_garage_door_timeout
  alias: Right garage door timeout
  trigger:
    platform: state
    entity_id: cover.right_door
  action:
    - delay:
        minutes: 10
    - service: cover.close_cover
      entity_id: cover.right_door
